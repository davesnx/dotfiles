#!/usr/bin/env bash

set -euo pipefail

source "$DOTFILES_PATH/scripts/core/_main.sh"

##? Run scripts from package.json
#?? 1.1.0
##?
##? Usage:
##?    run

if cat package.json > /dev/null 2>&1; then
    scripts=$(cat package.json | jq .scripts)

    if [[ ! -z "$scripts" ]]; then
        echo "Error: There's no scripts in the package.json"
        exit
    fi

    selected_script=$(cat package.json | jq .scripts | sed '1d;$d' | fzf --cycle --height 80% --header="Press ENTER to run the script. ESC to quit.")

    if [[ -n "$selected_script" ]]; then
        script_name=$(echo "$selected_script" | awk -F ': ' '{gsub(/"/, "", $1); print $1}')

        yarn run "$script_name" || npm run "$script_name"
    else
        echo "Exit: You haven't selected any script"
    fi
else
    echo "Error: There's no package.json"
fi
